<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Notificaciones de prueba</title>

  <!-- ðŸ”— Manifiesto e integraciÃ³n con iOS -->
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Benestar">
  <link rel="apple-touch-icon" href="icon-192.png">
</head>

<body>
  <h2>ðŸ”” Notificaciones automÃ¡ticas cada 10 segundos (modo debugging)</h2>
  <p>Si ves este texto, agrega esta pÃ¡gina a tu pantalla de inicio para probar en iPhone.</p>

  <script>
    // âœ… Registrar el Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(reg => {
          console.log("âœ… Service Worker registrado:", reg.scope);

          // Forzar control inmediato (algunas veces necesario en iOS)
          if (navigator.serviceWorker.controller) {
            console.log("SW ya controla esta pÃ¡gina");
          } else {
            console.log("Esperando a que el SW tome control...");
          }
        })
        .catch(err => console.error("âŒ Error SW:", err));
    }

    // âœ… FunciÃ³n para solicitar permiso al usuario
    async function pedirPermiso() {
      try {
        const permiso = await Notification.requestPermission();
        if (permiso === "granted") {
          console.log("âœ… Permiso concedido");
          enviarNotificacion(); // primera notificaciÃ³n inmediata
          setInterval(enviarNotificacion, 10000); // cada 10 segundos
        } else {
          console.log("âŒ Permiso denegado o bloqueado");
          alert("Activa las notificaciones en Ajustes > Benestar");
        }
      } catch (e) {
        console.error("Error al pedir permiso:", e);
      }
    }

    // âœ… Mostrar notificaciÃ³n a travÃ©s del SW
    function enviarNotificacion() {
      if (navigator.serviceWorker && navigator.serviceWorker.controller) {
        navigator.serviceWorker.controller.postMessage({
          title: "ðŸŽ‰ Bon dia!",
          body: "La teva web et saluda ðŸŒž",
          icon: "icon-192.png"
        });
        console.log("ðŸ“¨ NotificaciÃ³n enviada al SW");
      } else {
        console.warn("âš ï¸ No hay Service Worker activo aÃºn. Refresca la app una vez.");
      }
    }

    // âœ… AÃ±adir botÃ³n manual (iOS requiere interacciÃ³n del usuario)
    document.addEventListener("DOMContentLoaded", () => {
      const btn = document.createElement("button");
      btn.textContent = "ðŸ”” Activar notificacions";
      btn.style = `
        font-size:18px;
        padding:12px 20px;
        margin-top:20px;
        border-radius:8px;
        background:#4CAF50;
        color:white;
        border:none;
      `;
      btn.onclick = pedirPermiso;
      document.body.appendChild(btn);
    });
  </script>
</body>
</html>
